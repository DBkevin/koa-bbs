## 用户信息
### 重置密码
此前功能没有重置密码，忘记密码无法找回，今天我们要加上一个密码重置功能。这次采用邮箱发送邮件来做密码重置功能
先数据库新增2个字段， `email`和`remember_token`还有`remember_token_createat`。`email`用于存放用户邮箱，`remember_token`用来存放本次重置密码的token,`remember_token_createad`用于存放重置密码的时间戳。新版sql查看`doc/sql/users`。或[查看源码](https://github.com/DBkevin/koa-bbs/blob/main/doc/sql/users.sql)
#### 重置密码有4个步骤，分别是
* 进入重置密码页面;
* 提交重置帐号以及邮箱地址
* 发送重置token
* 进入最终重置页面重置密码
#### 重置密码路由
重置密码，我们需要注册一条路由，一个get路由用于显示重置密码表单，一个post路由用于接收重置表单提交的数据,打开`router/index.js`开始添加路由
```js
......
......
    router.get('/logout', require('./auth').logout);
    router.get('/password/email', require('./auth').email);
    router.post('/password/email', require('./auth').email);
......
```
然后在`router/auth.js`中编写`email`方法
```js
 async email(ctx, next) {
        let ejsconfig = {
            title: '重置密码',
            pagename: '../auth/email',
            routerName: 'reset',
        }
        if (ctx.method === 'GET') {
            await ctx.render("layouts/index", ejsconfig);
            return;
        }
    }
```
接着在`views/auth`下新建页面模板`email.ejs`
```html
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header"><%= title %></div>

                <div class="card-body">
                     <% if(locals.ok_email){ %>
                        <div class="alert alert-success" role="alert">
                           <%= ok_email %>
                        </div>
                       <% } %>
                    <form method="POST" action="/password/email">
                        <div class="form-group row">
                            <label for="email" class="col-md-4 col-form-label text-md-right">邮箱地址</label>

                            <div class="col-md-6">
                                <input id="email" type="email" class="form-control <%=locals.errors_email?'is-invalid':'' %>" name="email" value="<%=locals.errors_email?email:'' %>" required autocomplete="email" autofocus>
                                 <% if(locals.errors_email){ %>
                                    <span class="invalid-feedback" role="alert">
                                        <strong><%=errors_email%></strong>
                                    </span>
                                <% } %>
                            </div>
                        </div>
                        <div class="form-group row mb-0">
                            <div class="col-md-6 offset-md-4">
                                <button type="submit" class="btn btn-primary">
                                    发送重置密码链接
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
```
启动脚本，输入`localhosts:3000/password/email` 就可以看到效果了。如图：

解析来编辑提交邮箱地址之后的逻辑，基本逻辑为：‘
